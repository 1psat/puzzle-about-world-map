<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Пазл физическая карты Мира</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: url('background-image.jpg') no-repeat center center fixed;
            background-size: cover;
            margin: 0;
            padding: 0;
        }

        h1 {
            color: white;
            margin: 20px;
        }

        .menu {
            margin: 20px;
        }

        .menu button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }

        #puzzle-container {
            position: relative;
            margin: auto;
            display: none;
            max-width: 90%;
        }

        .piece {
            position: absolute;
            cursor: grab;
            border: 1px solid #000;
        }

        #timer {
            color: white;
            font-size: 20px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Пазл физическая карты Мира</h1>

    <div class="menu">
        <label for="difficulty">Выберите сложность:</label>
        <select id="difficulty">
            <option value="4">4 x 4</option>
            <option value="6">6 x 6</option>
            <option value="8">8 x 8</option>
        </select>
        <button onclick="startGame()">Старт</button>
    </div>

    <div id="puzzle-container"></div>

    <div id="timer">Время: 0 секунд</div>

    <script>
        const puzzleContainer = document.getElementById('puzzle-container');
        const timerElement = document.getElementById('timer');
        let time = 0;
        let timerInterval;

        function startTimer() {
            time = 0;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                time++;
                timerElement.textContent = `Время: ${time} секунд`;
            }, 1000);
        }

        function stopTimer() {
            clearInterval(timerInterval);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            const difficulty = parseInt(document.getElementById('difficulty').value);
            const image = new Image();
            image.src = 'puzzle-image.jpg';
            image.onload = () => {
                setupPuzzle(image, difficulty);
                startTimer();
            };
        }

        function setupPuzzle(image, gridSize) {
            puzzleContainer.innerHTML = '';
            puzzleContainer.style.width = `${image.width}px`;
            puzzleContainer.style.height = `${image.height}px`;
            puzzleContainer.style.display = 'block';

            const pieceWidth = image.width / gridSize;
            const pieceHeight = image.height / gridSize;
            const positions = [];

            for (let y = 0; y < gridSize; y++) {
                for (let x = 0; x < gridSize; x++) {
                    positions.push({ x: x * pieceWidth, y: y * pieceHeight });
                }
            }

            shuffleArray(positions);

            positions.forEach((pos, index) => {
                const piece = document.createElement('div');
                piece.classList.add('piece');
                piece.style.width = `${pieceWidth}px`;
                piece.style.height = `${pieceHeight}px`;
                piece.style.backgroundImage = `url('${image.src}')`;
                piece.style.backgroundSize = `${image.width}px ${image.height}px`;
                piece.style.backgroundPosition = `-${(index % gridSize) * pieceWidth}px -${Math.floor(index / gridSize) * pieceHeight}px`;
                piece.style.left = `${pos.x}px`;
                piece.style.top = `${pos.y}px`;

                piece.draggable = true;
                piece.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', index);
                });

                puzzleContainer.appendChild(piece);
            });

            puzzleContainer.addEventListener('dragover', (e) => {
                e.preventDefault();
            });

            puzzleContainer.addEventListener('drop', (e) => {
                e.preventDefault();
                const draggedIndex = e.dataTransfer.getData('text');
                const droppedPiece = e.target;

                if (droppedPiece.classList.contains('piece')) {
                    const draggedPiece = puzzleContainer.children[draggedIndex];

                    const draggedLeft = draggedPiece.style.left;
                    const draggedTop = draggedPiece.style.top;

                    draggedPiece.style.left = droppedPiece.style.left;
                    draggedPiece.style.top = droppedPiece.style.top;

                    droppedPiece.style.left = draggedLeft;
                    droppedPiece.style.top = draggedTop;
                }

                checkWinCondition(gridSize, pieceWidth, pieceHeight);
            });
        }

        function checkWinCondition(gridSize, pieceWidth, pieceHeight) {
            let correctPieces = 0;

            Array.from(puzzleContainer.children).forEach((piece, index) => {
                const correctX = (index % gridSize) * pieceWidth;
                const correctY = Math.floor(index / gridSize) * pieceHeight;

                if (parseInt(piece.style.left) === correctX && parseInt(piece.style.top) === correctY) {
                    correctPieces++;
                }
            });

            if (correctPieces === gridSize * gridSize) {
                stopTimer();
                alert(`Поздравляем! Вы собрали пазл за ${time} секунд.`);
            }
        }
    </script>
</body>
</html>
